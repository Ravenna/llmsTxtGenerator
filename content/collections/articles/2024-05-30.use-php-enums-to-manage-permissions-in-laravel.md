---
id: e99470ad-ad5c-4a70-b1fa-5a9026c68436
blueprint: article
title: 'Use php enums to manage permissions in Laravel.'
author: 0f0756d9-2088-41aa-94cf-4307d8462ba6
seo:
  title: '@seo:title'
  image: '@seo:social_share_image'
updated_by: 1d1068ab-208d-480d-a677-dda65fe0f490
updated_at: 1727195118
content:
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Managing permissions for your application can seem daunting at first. This is due in no small part to how complicated IAM systems can become for large applications. Thankfully, once we leave infrastructure and head into the application, managing users and permissions becomes comparatively simple. And if you’re using Laravel, managing permissions can actually be fun! I’ve said this before, and I’ll say it a thousand times. Laravel makes everything fun.'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        marks:
          -
            type: link
            attrs:
              href: 'https://www.php.net/manual/en/language.types.enumerations.php'
              rel: null
              target: null
              title: null
          -
            type: underline
        text: 'What are enums?'
      -
        type: text
        text: ' We will get to that later. What are permissions? I’m glad you asked! At their core, permissions are just two things:'
  -
    type: orderedList
    attrs:
      start: 1
    content:
      -
        type: listItem
        content:
          -
            type: paragraph
            attrs:
              class: null
            content:
              -
                type: text
                text: 'A representation of an action, e.g., “edit projects”'
      -
        type: listItem
        content:
          -
            type: paragraph
            attrs:
              class: null
            content:
              -
                type: text
                text: 'An attachment of that representation to a user, e.g., “Vanessa can edit projects”'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Anyone familiar with databases can see right away that all we need is a table for permissions, a table for users, and a join table for both. BOOM! We are managing permissions. This is an oversimplification of how you might want to manage permissions, but at their core, this is all permissions need to be.'
  -
    type: blockquote
    content:
      -
        type: paragraph
        attrs:
          class: null
        content:
          -
            type: text
            marks:
              -
                type: italic
            text: 'We only need a table for permissions, a table for users, and a join table for both. BOOM! We are managing permissions.'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Ok, enums. Where do they factor in here? Enums come in at the code layer, the “business” layer, to help enforce a certain set of values. To me, there are two major benefits they have for permissions:'
  -
    type: orderedList
    attrs:
      start: 1
    content:
      -
        type: listItem
        content:
          -
            type: paragraph
            attrs:
              class: null
            content:
              -
                type: text
                text: 'Seeding permissions becomes a breeze'
      -
        type: listItem
        content:
          -
            type: paragraph
            attrs:
              class: null
            content:
              -
                type: text
                text: 'Enforcing naming conventions for permissions prevents bugs'
  -
    type: heading
    attrs:
      level: 2
    content:
      -
        type: text
        text: 'Seeding Permissions with Enums'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Think about all your models. Think about the '
      -
        type: text
        marks:
          -
            type: italic
        text: stuff
      -
        type: text
        text: " in your app. Maybe it's projects, deliverables, and notes? Maybe it's shipments, agents, and invoices? Maybe it's furries and fur suits? I don’t know, you do you. The point is, you probably have a lot of important "
      -
        type: text
        marks:
          -
            type: italic
        text: stuff
      -
        type: text
        text: '. And you are going to need multiple permissions for each stuff because remember:'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: image
        attrs:
          src: 'asset::assets::8rjmsk.webp'
          alt: null
      -
        type: text
        text: 'Create furry, read furry, update furry, delete furry. Do you want to write all that by hand for each of your stuffs? Of course not; you’re a developer! You want to automate adding <strong> tags around text. Some of you learn VIM, so you never have to touch a mouse. Efficiency is the name of the game. Not to mention, that’s a whole lot of magic strings to have to remember and potentially (inevitably) screw up. Enter enums.'
  -
    type: set
    attrs:
      id: lwtfg33w
      values:
        type: code
        inline_code:
          code: |-
            namespace App\Enums;

            enum CrudPermissionEnum : string

            {
               case CREATE = 'create';
               case READ = 'read';
               case UPDATE = 'update';
               case DELETE = 'delete';
            }
          mode: php
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'This is an enum. More specifically, it is a “'
      -
        type: text
        marks:
          -
            type: link
            attrs:
              href: 'https://www.php.net/manual/en/language.enumerations.backed.php'
              rel: null
              target: null
              title: null
          -
            type: underline
        text: backed
      -
        type: text
        text: '” enum. This means that the enum represents an underlying scalar value, in this case, a string. When using enums backed by a string, you can enforce values for strings in the business layer before they get to your database. I know some of you are screaming right now, “You can implement enums in the database!” Sure, you can, but it isn’t the best. This very old but still relevant article outlines many'
      -
        type: text
        marks:
          -
            type: link
            attrs:
              href: 'https://komlenic.com/244/8-reasons-why-mysqls-enum-data-type-is-evil/'
              rel: null
              target: null
              title: null
          -
            type: underline
        text: " great reasons why it's not ideal"
      -
        type: text
        text: '. And not every database supports enums as a type. Hence, we are using enums in PHP BEFORE they get to the database. Let your business layer handle the business logic, and let your database just say, “OK, boss.”'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'So, we have our enum mapping CRUD operations to a string value. It is not too useful, but it is the first building block to our amazing permission seeding solution. Step two is mapping models to enums:'
  -
    type: set
    attrs:
      id: lwtfgh7i
      values:
        type: code
        inline_code:
          code: |-
            namespace App\Enums;

            enum ModelEnum : string

            {
               case PROJECT = 'projects';
               case DELIVERABLE = 'deliverables';
               case COMMENT = 'comment';
               ...
            }
          mode: php
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Using an enum, map all the models you need permissions for to a permission-friendly name. Common convention, just use the plural form of your model name.'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Now that we have our models and permissions in enums, we can easily write a function to generate common permissions for every model. In my experience, this is best done in a seeder:'
  -
    type: set
    attrs:
      id: lwtfgzp7
      values:
        type: code
        inline_code:
          code: |-
            namespace Database\Seeders;

            use YourPermissionModel;

            class PermissionSeeder extends Seeder
            {

             	public function run(): void
             	{
               		$crudPermissions = CrudPermissionEnum::cases();
            		$models = ModelEnum::cases();
            		...
            	}
            }
          mode: php
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Pause here. Cases? This handy function gives us all the cases of an enum in an array. So, with some simple nested loops, we can seed all our permissions:'
  -
    type: set
    attrs:
      id: lwtfhxc3
      values:
        type: code
        inline_code:
          code: |-
            foreach($models as $m) {
            	foreach ($crudPermissions as $p) {
            		YourPermissionModel::create([name => "{$p->value} {$m->value}"]);
            	}
            }
          mode: php
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'With a few lines of code, we’ve created crud permissions for every model we want. But that’s not even the best we can do. How about a slight refactor? Instead of nested foreach loops:'
  -
    type: set
    attrs:
      id: lwtfihkt
      values:
        type: code
        inline_code:
          code: |-
            $crudPermissions = collect(CrudPermissionEnum::cases());
            $models = collect(ModelEnum::cases());

            // Use reduce instead of map so we avoid having to flatten a nested array
            $permissions = $crudPermissions->reduce(function($carry, $p){
            	$models->each(function($m) use ($p){
            		$carry->push(['name' => "{p->value} {$m->value}"]);
            	});
            	return $carry;
            }, collect());

            YourPermissionModel::upsert($permissions);
          mode: php
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Wait, did we add more lines of code? Yes, you sweet summer child! But we are now using the upsert instead of the create method. This has the benefit of making one database call and creating new permissions ONLY if they don’t already exist in the database. So if we add a model or permission and run our seeder again, this bad boy isn’t gonna put up a fuss.'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        marks:
          -
            type: bold
        text: 'Enforcing naming conventions with enums'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Alright, we have our permissions seeded. We have a route to one of our models that requires permissions. Let the power of enums show itself once more:'
  -
    type: set
    attrs:
      id: lwtfk0ln
      values:
        type: code
        inline_code:
          code: |-
            Route::get('/fur-suits', function(Request $request){
            	$user = auth()->user();
            	try {
               		$can = $user->permissions()
            			->where('name', '=', "{CrudPermissionEnum::READ->value} {ModelEnum::FURSUIT->value}")
            			->firstOrFail();

               		return "You can view this!";
            	} 
            	catch(\Exception $e) {
            		return $response("You can't do that", 401);
            	 }
            });
          mode: php
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: "Admittedly, typing out the names of those enums is cumbersome. The good news is that your text editor will auto-load most of the names for you. The better news is that you won’t forget your permissions' names anytime soon. Think about how much more cumbersome it is to reference a separate list of permission names, even if they are in a config file."
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Typically, you’d want to rely on middleware for routing authorization and a '
      -
        type: text
        marks:
          -
            type: link
            attrs:
              href: 'https://laravel.com/docs/11.x/authorization#creating-policies'
              rel: null
              target: null
              title: null
          -
            type: underline
        text: policy
      -
        type: text
        text: ' for models. You can reference the permissions for a user within the policy.'
  -
    type: set
    attrs:
      id: lwtfmpsd
      values:
        type: code
        inline_code:
          code: |-
            // App\Policies

            class FurSuitPolicy
            {
            	public function read(User $user)
            	{
            		$name = "{CrudPermissionEnum::READ->value} {ModelEnum::FURSUIT->value}";
            		return $user->permissions()->where('name', $name)->exists();
            	}

            }

            // Routes
            Route::get('/fur-suits', function(Request $request){
            	return "You can do that!"
            })->can('read', FurSuit::class);
          mode: php
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Perhaps within this fur suit route, you want the user to be able to edit the fur suit. After all, who wouldn’t want to do that? But they need the permission first. Let’s pretend a magic method exists to check if a user has permission by string name (if you are using a package like Laravel Permission, this is built in. '
      -
        type: text
        marks:
          -
            type: link
            attrs:
              href: 'https://spatie.be/docs/laravel-permission/v6/basic-usage/enums'
              rel: null
              target: null
              title: null
          -
            type: underline
        text: 'And, they recommend using enums!'
      -
        type: text
        text: )
  -
    type: set
    attrs:
      id: lwtfngeu
      values:
        type: code
        inline_code:
          code: |-
            // A blade file

            @if (auth()->user()->hasPermission("{CrudPermissionEnum::UPDATE->value} {ModelEnum::FURSUIT->value}"))
            	You can edit this
            @endif
          mode: php
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'We’ve switched from policy file to blade template without losing track of the permission names and how to call them because we are using enums. And because we started with enums when seeding the database, they will be consistent throughout the application. No bugs when we misspell a model, forget we used plural for the naming convention, or forget that instead of “edit fursuit,” it is “update fursuits.” No checking for the WRONG permission when trying to safeguard a route. Nope, all that is not an issue when we stick with enums as our preferred way to create and access permissions.'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: text
        text: 'Hopefully, you can see the value of using enums to seed and manage permissions. I will be writing more about managing permissions yourself in future articles. Stay tuned!'
  -
    type: paragraph
    attrs:
      class: null
    content:
      -
        type: hardBreak
---
